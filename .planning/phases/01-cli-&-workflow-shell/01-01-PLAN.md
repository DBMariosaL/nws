---
phase: 01-cli-&-workflow-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - src/cli/index.ts
  - src/cli/commands/init.ts
  - src/cli/commands/plan.ts
  - src/cli/commands/apply.ts
  - src/cli/commands/handover.ts
  - src/workflow/init.ts
  - src/workflow/plan.ts
  - src/workflow/apply.ts
  - src/workflow/handover.ts
  - src/utils/logging.ts
autonomous: true

must_haves:
  truths:
    - "User can run `nws init`, `nws plan`, `nws apply`, and `nws handover` successfully."
    - "CLI runs in non-interactive/headless mode when `--yes` is provided."
    - "CLI exposes a single `nws` binary via npm bin mapping."
  artifacts:
    - path: "package.json"
      provides: "npm bin entry for `nws` and scripts"
      contains: "\"bin\": { \"nws\""
    - path: "src/cli/index.ts"
      provides: "CLI entrypoint wiring to subcommands"
    - path: "src/workflow/init.ts"
      provides: "init workflow stub"
    - path: "src/workflow/plan.ts"
      provides: "plan workflow stub"
    - path: "src/workflow/apply.ts"
      provides: "apply workflow stub"
    - path: "src/workflow/handover.ts"
      provides: "handover workflow stub"
  key_links:
    - from: "package.json"
      to: "bin/cli.js"
      via: "bin mapping"
      pattern: "\"nws\"\\s*:\\s*\"bin/cli.js\""
    - from: "src/cli/commands/apply.ts"
      to: "src/workflow/apply.ts"
      via: "command handler call"
      pattern: "applyWorkflow\\("
---

<objective>
Establish the Node.js/TypeScript CLI shell with runnable workflow commands and headless-safe behavior.

Purpose: Provide a single `nws` binary that can run the workflow commands and support automation.
Output: CLI scaffolding, command wiring, and workflow stubs that execute without prompts when `--yes` is set.
</objective>

<execution_context>
@C:\Users\Referent BIM\.config\opencode/get-shit-done/workflows/execute-plan.md
@C:\Users\Referent BIM\.config\opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-cli-&-workflow-shell/01-RESEARCH.md
@.planning/research/STACK.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold the Node/TypeScript CLI package</name>
  <files>package.json, tsconfig.json</files>
  <action>
Create a minimal Node.js + TypeScript package for the CLI using ESM. Add `bin` mapping for `nws` to `bin/cli.js`, set `type: "module"`, and require Node 24+ in `engines`. Include scripts: `build` (tsc), `dev` (tsx), `start` (node bin/cli.js). Add dependencies: `commander`, `prompts`, `env-paths`, `zod`, `pino`. Add dev deps: `typescript`, `tsx`.

Create `tsconfig.json` with `module`/`moduleResolution` set to `NodeNext`, `rootDir` = `src`, `outDir` = `bin`, `target` = `ES2022`, `strict: true`, and `skipLibCheck: true`. Ensure build output preserves the shebang from the CLI entry file.
  </action>
  <verify>npm install && npm run build</verify>
  <done>`bin/cli.js` is generated and `package.json` exposes `nws` via the npm bin mapping.</done>
</task>

<task type="auto">
  <name>Task 2: Implement CLI entrypoint and workflow command shells</name>
  <files>src/cli/index.ts, src/cli/commands/init.ts, src/cli/commands/plan.ts, src/cli/commands/apply.ts, src/cli/commands/handover.ts, src/workflow/init.ts, src/workflow/plan.ts, src/workflow/apply.ts, src/workflow/handover.ts, src/utils/logging.ts</files>
  <action>
Create `src/cli/index.ts` with a `#!/usr/bin/env node` shebang, set up commander root command `nws`, and register subcommands `init`, `plan`, `apply`, `handover`. Add global options `--yes` and `--json` (for headless output) and propagate them to handlers. Add minimal workflow stubs in `src/workflow/*.ts` that return a structured result `{ command, status, message }` without side effects.

Implement a small logger helper in `src/utils/logging.ts`: when `--json` is true, emit a single-line JSON payload (use `pino` or `console.log(JSON.stringify(...))`), otherwise print a short human-readable line. For `apply`, require explicit confirmation via `prompts` unless `--yes` is set; if `process.stdout.isTTY` is false and `--yes` is not provided, exit with a clear error instructing to pass `--yes`.
  </action>
  <verify>npm run build && node "bin/cli.js" init --yes && node "bin/cli.js" apply --yes --json</verify>
  <done>`nws` runs all four commands without crashing; `apply` refuses to prompt in non-interactive mode unless `--yes` is set.</done>
</task>

</tasks>

<verification>
- `nws --help` lists init/plan/apply/handover commands.
- Running `node "bin/cli.js" init --yes` exits 0 and prints a completion message.
- `node "bin/cli.js" apply --yes --json` outputs a single JSON object and exits 0.
</verification>

<success_criteria>
The CLI can be built and executed via the `nws` binary, and the core workflow commands run in headless mode when `--yes` is supplied.
</success_criteria>

<output>
After completion, create `.planning/phases/01-cli-&-workflow-shell/01-01-SUMMARY.md`
</output>
