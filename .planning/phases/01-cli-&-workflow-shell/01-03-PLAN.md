---
phase: 01-cli-&-workflow-shell
plan: 03
type: execute
wave: 2
depends_on: ["01", "02"]
files_modified:
  - src/cli/packs/schema.ts
  - src/cli/packs/install.ts
  - src/cli/commands/pack.ts
  - src/cli/index.ts
  - packs/opencode/pack.md
  - packs/claude-code/pack.md
autonomous: true

must_haves:
  truths:
    - "User can install OpenCode command pack locally or globally."
    - "User can install Claude Code command pack locally or globally."
    - "Pack installation uses the discovered official install locations."
  artifacts:
    - path: "packs/opencode/pack.md"
      provides: "OpenCode command pack definition"
    - path: "packs/claude-code/pack.md"
      provides: "Claude Code command pack definition"
    - path: "src/cli/commands/pack.ts"
      provides: "CLI command to install packs"
  key_links:
    - from: "src/cli/commands/pack.ts"
      to: "src/cli/packs/install.ts"
      via: "install helper call"
      pattern: "installPack\\("
    - from: "src/cli/packs/install.ts"
      to: "env-paths"
      via: "install destination resolution"
      pattern: "envPaths\\("
---

<objective>
Create command pack assets and an installer command that supports local and global installs.

Purpose: Satisfy CLI-01 by shipping pack files and a reliable install mechanism.
Output: Pack definitions for OpenCode and Claude Code plus `nws pack install` to copy them to the official locations.
</objective>

<execution_context>
@C:\Users\Referent BIM\.config\opencode/get-shit-done/workflows/execute-plan.md
@C:\Users\Referent BIM\.config\opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-cli-&-workflow-shell/01-RESEARCH.md
@.planning/phases/01-cli-&-workflow-shell/01-DISCOVERY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement pack schema and installer utilities</name>
  <files>src/cli/packs/schema.ts, src/cli/packs/install.ts</files>
  <action>
Create a zod schema for pack metadata based on `01-DISCOVERY.md` (frontmatter keys, required fields, command entries). Implement an installer helper that:
- Resolves official local/global install destinations using `env-paths` and the discovered install rules.
- Copies pack files to the destination (create directories as needed).
- Validates the pack before install and returns a structured result `{ pack, scope, installedPaths }`.
- Supports `--force` to overwrite existing files; otherwise fail with a clear error.
Avoid custom OS path logic; rely on `env-paths` and the discovery rules.
  </action>
  <verify>npm run build</verify>
  <done>Pack install helper validates packs and resolves destinations from discovery without hard-coded OS branching.</done>
</task>

<task type="auto">
  <name>Task 2: Add `nws pack install` command</name>
  <files>src/cli/commands/pack.ts, src/cli/index.ts</files>
  <action>
Add a `pack` command with subcommand `install` wired into the CLI. Required options: `--target opencode|claude` (pack to install) and `--scope local|global`. Optional flags: `--force` to overwrite, `--json` to emit structured output. Use the installer helper and print a success summary (or JSON) that includes destination paths. Ensure the command supports local and global installs for both OpenCode and Claude Code packs (CLI-01).
  </action>
  <verify>npm run build && node "bin/cli.js" pack install --target opencode --scope local --force && node "bin/cli.js" pack install --target claude --scope global --force</verify>
  <done>`nws pack install` supports local/global installs for both packs and reports installed paths.</done>
</task>

<task type="auto">
  <name>Task 3: Create command pack assets</name>
  <files>packs/opencode/pack.md, packs/claude-code/pack.md</files>
  <action>
Create the OpenCode and Claude Code command pack files using the exact format and required frontmatter from `01-DISCOVERY.md`. Include commands for `/nws:init`, `/nws:plan`, `/nws:apply`, `/nws:handover` that execute `nws init|plan|apply|handover` and pass through `--yes` and `--json` flags where supported by the spec. Keep content ASCII and avoid extra commands not defined in the discovery spec.
  </action>
  <verify>node "bin/cli.js" pack install --target claude --scope local --force</verify>
  <done>Both pack files install successfully and expose the four workflow commands.</done>
</task>

</tasks>

<verification>
- `nws pack install --target opencode --scope local --force` installs files to the discovered local path.
- `nws pack install --target claude --scope global --force` installs files to the discovered global path.
- Installed packs include commands mapped to `nws init/plan/apply/handover`.
</verification>

<success_criteria>
Users can install OpenCode and Claude Code packs locally or globally using the CLI and the official pack formats.
</success_criteria>

<output>
After completion, create `.planning/phases/01-cli-&-workflow-shell/01-03-SUMMARY.md`
</output>
